{% extends 'predictions/base.html' %}

{% block title %}Prédictions - Olympic Medals Prediction{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1><i class="bi bi-graph-up"></i> Prédictions des Médailles</h1>
        <p class="text-muted">Prédictions basées sur l'analyse des données historiques et le machine learning</p>
    </div>
</div>

{% if predictions %}
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="bi bi-lightbulb"></i> Prédictions pour les Prochains Jeux</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Rang</th>
                                <th>Pays</th>
                                <th>Jeu Olympique</th>
                                <th class="text-center"><i class="bi bi-trophy-fill medal-gold"></i></th>
                                <th class="text-center"><i class="bi bi-trophy-fill medal-silver"></i></th>
                                <th class="text-center"><i class="bi bi-trophy-fill medal-bronze"></i></th>
                                <th class="text-center">Total</th>
                                <th class="text-center">Confiance</th>
                                <th class="text-center">Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for prediction in predictions %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td>
                                    <a href="{% url 'predictions:country_detail' prediction.country.id %}">
                                        {{ prediction.country.country_name }}
                                    </a>
                                </td>
                                <td>
                                    <span class="badge bg-info">{{ prediction.predicted_game }}</span>
                                </td>
                                <td class="text-center">{{ prediction.predicted_gold }}</td>
                                <td class="text-center">{{ prediction.predicted_silver }}</td>
                                <td class="text-center">{{ prediction.predicted_bronze }}</td>
                                <td class="text-center">
                                    <strong class="text-primary">{{ prediction.predicted_total }}</strong>
                                </td>
                                <td class="text-center">
                                    <span class="badge 
                                        {% if prediction.confidence_score >= 0.8 %}bg-success
                                        {% elif prediction.confidence_score >= 0.6 %}bg-warning
                                        {% else %}bg-danger{% endif %}">
                                        {{ prediction.confidence_score|floatformat:2 }}
                                    </span>
                                </td>
                                <td class="text-center">
                                    <small>{{ prediction.created_at|date:"d/m/Y" }}</small>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-lg-6 mb-3">
        <div class="card h-100">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0"><i class="bi bi-cpu"></i> Modèle d'IA Utilisé</h5>
            </div>
            <div class="card-body">
                <h6 class="text-primary">
                    <span class="badge bg-success">Régression</span> Algorithme de Prédiction Statistique
                </h6>
                <p class="small">
                    Le modèle utilise une <strong>approche de régression statistique</strong> avec analyse de séries temporelles 
                    pour prédire le nombre de médailles (variable continue).
                </p>
                
                <div class="alert alert-primary small mb-3">
                    <strong>Type de ML:</strong> <span class="badge bg-info">Régression Multi-Output</span><br>
                    <strong>Approche:</strong> Statistical Learning (Moyenne Mobile + Ratios)<br>
                    <strong>Variables Cibles:</strong> 3 outputs continus (Or, Argent, Bronze)
                </div>

                <h6 class="text-primary mt-3">Composantes du Modèle</h6>
                <ul class="small">
                    <li><strong>Régression Temporelle:</strong> Analyse des 5 derniers Jeux (séries temporelles)</li>
                    <li><strong>Moyenne Mobile:</strong> Lissage exponentiel des tendances</li>
                    <li><strong>Variance & Écart-Type:</strong> Mesure de stabilité des performances</li>
                    <li><strong>Régression Proportionnelle:</strong> Distribution Or/Argent/Bronze par ratios</li>
                </ul>

                <h6 class="text-primary mt-3">Score de Confiance</h6>
                <p class="small mb-1">
                    <strong>Méthode:</strong> Score composite basé sur la fiabilité statistique
                </p>
                <ul class="small mb-0">
                    <li>Participation historique: 40% (robustesse des données)</li>
                    <li>Régularité (1-CV): 40% (coefficient de variation inverse)</li>
                    <li>Performance absolue: 20% (normalisation sur 100)</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="col-lg-6 mb-3">
        <div class="card h-100">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="bi bi-graph-up-arrow"></i> Méthodologie</h5>
            </div>
            <div class="card-body">
                <h6 class="text-success">Pipeline de Prédiction (Régression)</h6>
                
                <div class="mb-3">
                    <span class="badge bg-primary me-2">1</span>
                    <strong>Feature Engineering</strong>
                    <p class="small ms-4 mb-2">
                        Extraction des features: historique médailles, tendances temporelles, moyennes par jeu.
                    </p>
                </div>

                <div class="mb-3">
                    <span class="badge bg-primary me-2">2</span>
                    <strong>Régression Statistique</strong>
                    <p class="small ms-4 mb-2">
                        Calcul de la moyenne mobile pondérée sur 5 jeux + analyse de variance (écart-type).
                    </p>
                </div>

                <div class="mb-3">
                    <span class="badge bg-primary me-2">3</span>
                    <strong>Multi-Output Regression</strong>
                    <p class="small ms-4 mb-2">
                        Prédiction simultanée de 3 variables continues: nombre médailles Or, Argent, Bronze.
                    </p>
                </div>

                <div class="mb-3">
                    <span class="badge bg-primary me-2">4</span>
                    <strong>Confidence Scoring</strong>
                    <p class="small ms-4 mb-2">
                        Évaluation de la fiabilité par score composite (participation, régularité, performance).
                    </p>
                </div>

                <div class="alert alert-info small mb-2">
                    <strong><i class="bi bi-lightbulb"></i> Type de Problème:</strong><br>
                    <span class="badge bg-success me-1">Régression</span> 
                    <span class="badge bg-info me-1">Série Temporelle</span>
                    <span class="badge bg-warning text-dark">Multi-Output</span>
                </div>

                <div class="alert alert-warning small mb-0">
                    <strong><i class="bi bi-exclamation-triangle"></i> Limitations:</strong> 
                    Modèle statistique simplifié. Pour production: considérer Random Forest Regressor, 
                    XGBoost, ou LSTM pour séries temporelles complexes.
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-3">
    <div class="col-12">
        <div class="card border-warning">
            <div class="card-header bg-warning">
                <h5 class="mb-0"><i class="bi bi-calculator"></i> Formules Utilisées</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <h6 class="text-warning">Prédiction du Total</h6>
                        <div class="bg-light p-3 rounded">
                            <code>
                                predicted_total = moyenne(médailles_5_derniers_jeux)
                            </code>
                        </div>
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <h6 class="text-warning">Distribution par Type</h6>
                        <div class="bg-light p-3 rounded">
                            <code>
                                predicted_gold = total × ratio_historique_or
                            </code>
                        </div>
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <h6 class="text-warning">Score de Confiance</h6>
                        <div class="bg-light p-3 rounded">
                            <code>
                                confidence = (participation×0.4 + régularité×0.4 + performance×0.2)
                            </code>
                        </div>
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <h6 class="text-warning">Régularité</h6>
                        <div class="bg-light p-3 rounded">
                            <code>
                                régularité = 1 - min(écart_type / moyenne, 1)
                            </code>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-secondary small mt-3 mb-0">
                    <div class="row">
                        <div class="col-md-6">
                            <strong><i class="bi bi-graph-up"></i> Type de ML:</strong><br>
                            <span class="badge bg-success">Régression Statistique</span><br>
                            Prédiction de valeurs continues (nombre de médailles)
                        </div>
                        <div class="col-md-6">
                            <strong><i class="bi bi-list-check"></i> Variables Utilisées:</strong><br>
                            • Country (Pays)<br>
                            • Medal Type (Or/Argent/Bronze)<br>
                            • Game Year (Série temporelle)<br>
                            • Historical Performance (Tendances)
                        </div>
                    </div>
                    <hr class="my-2">
                    <small>
                        <strong>Note Technique:</strong> Ce n'est <u>pas de la classification</u> car on prédit des quantités numériques 
                        (combien de médailles), pas des catégories. C'est de la <strong>régression multi-output</strong> 
                        avec 3 variables dépendantes continues.
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>
{% else %}
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body text-center py-5">
                <i class="bi bi-graph-up-arrow fs-1 text-muted"></i>
                <h3 class="mt-3">Aucune Prédiction Disponible</h3>
                <p class="text-muted">
                    Les prédictions seront générées après l'entraînement du modèle de machine learning.<br>
                    Le modèle analyse les données historiques pour prédire les performances futures.
                </p>
                <div class="alert alert-info mt-3">
                    <strong>Pour générer des prédictions:</strong>
                    <ol class="text-start mt-2 mb-0">
                        <li>Assurez-vous que les données sont importées</li>
                        <li>Entraînez le modèle de machine learning</li>
                        <li>Générez les prédictions pour les prochains jeux</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}
